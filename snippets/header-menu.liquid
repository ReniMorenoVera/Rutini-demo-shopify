{%- assign main_menu = section.settings.menu -%}

<div class="dropdown">
  <a class="menu-button">{{ section.settings.header_button }}
    {% render 'icons',
      icon: 'caret',
      class: 'icon-arrow end-0 ms-1',
      attr: 'width="12px"'
    -%}
  </a>

  <ul class="dropdown-menu" id="main-menu__nav">
    <ul class="main-menu__nav list-unstyled d-flex flex-wrap m-0{% if section.settings.logo_position == 'left' %} justify-content-end{% endif %}">
      {%- for menu_link in linklists[main_menu].links -%}
        {%- assign is_mega = false -%}
        {%- for block in section.blocks -%}
          {%- assign menu_item = menu_link.title -%}
          {%- if block.settings.title contains menu_item -%}
            {%- assign is_mega = true -%}
            {% include 'header-megamenu' %}
            {%- break -%}
          {%- endif -%}
        {%- endfor -%}
        {%- if is_mega == false -%}
          {%- if menu_link.links != blank -%}
            {% comment %}====== MENU DROPDOWN LEVEL I ======{% endcomment %}
            <li class="main-menu__nav-item menu-dropdown menu-dropdown--basic{% if menu_link.active %} active{% endif %}">
              <a href="{{ menu_link.url }}" title="{{ menu_link.title | escape }}">
                {{- menu_link.title }}
                {% render 'icons', icon: 'caret', class: 'ms-1', attr: 'width="10px" height="15px" style="transform: rotate(270deg);"' -%}
              </a>
              <ul class="menu-dropdown__content list-unstyled" style="flex-direction: column !important;">
                {%- for menu_link_child in menu_link.links -%}
                  {%- if menu_link_child.links != blank -%}
                    {% comment %}====== MENU DROPDOWN LEVEL II ======{% endcomment %}
                    <li class="menu-dropdown menu-dropdown--basic{% if menu_link_child.active %} active{% endif %}">
                      <a
                        class="main-menu__link"
                        href="{{ menu_link_child.url }}"
                        title="{{ menu_link_child.title | escape }}"
                      >
                        {{- menu_link_child.title }}
                        {% render 'icons',
                          icon: 'caret',
                          class: 'icon-arrow position-absolute end-0 mt-1',
                          attr: 'width="12px" style="transform: rotate(270deg);"'
                        -%}
                      </a>
                      <ul class="menu-dropdown__content">
                        {%- for menu_link_child1 in menu_link_child.links -%}
                          {%- if menu_link_child1.links != blank -%}
                            {% comment %}====== MENU DROPDOWN LEVEL III ======{% endcomment %}
                            <li class="menu-dropdown menu-dropdown--basic{% if menu_link_child1.active %} active{% endif %}">
                              <a class="main-menu__link" href="{{ menu_link_child1.url }}" title="">
                                {{- menu_link_child1.title }}
                                {% render 'icons',
                                  icon: 'caret',
                                  class: 'icon-arrow position-absolute end-0 mt-1',
                                  attr: 'width="12px" style="transform: rotate(270deg);"'
                                -%}
                              </a>
                              <ul class="menu-dropdown__content">
                                {%- for menu_link_child2 in menu_link_child1.links -%}
                                  <li class="{% if menu_link_child2.active %}active{% endif %}">
                                    <a
                                      class="main-menu__link"
                                      href="{{ menu_link_child2.url }}"
                                      title="{{ menu_link_child2.title | escape }}"
                                    >
                                      {{- menu_link_child2.title -}}
                                    </a>
                                  </li>
                                {%- endfor -%}
                              </ul>
                            </li>
                          {%- else -%}
                            <li class="{% if menu_link_child1.active %}active{% endif %}">
                              <a
                                class="main-menu__link"
                                href="{{ menu_link_child1.url }}"
                                title="{{ menu_link_child1.title | escape }}"
                              >
                                {{- menu_link_child1.title -}}
                              </a>
                            </li>
                          {%- endif -%}
                        {%- endfor -%}
                      </ul>
                    </li>
                  {%- else -%}
                    <li class="{% if menu_link_child.active %}active{% endif %}">
                      <a
                        class="main-menu__link"
                        href="{{ menu_link_child.url }}"
                        title="{{ menu_link_child.title | escape }}"
                      >
                        {{- menu_link_child.title -}}
                      </a>
                    </li>
                  {%- endif -%}
                {%- endfor -%}
              </ul>
            </li>
          {%- else -%}
            <li class="main-menu__nav-item{% if menu_link.active %} active{% endif %}">
              <a class="main-menu__link" href="{{ menu_link.url }}" title="{{ menu_link.title | escape }}">
                {{- menu_link.title -}}
              </a>
            </li>
          {%- endif -%}
        {%- endif -%}
      {%- endfor -%}
    </ul>
  </ul>
</div>

<style>
  .dropdown {
    position: relative;
    display: inline-block;
  }

  .dropdown-button {
    background-color: #4CAF50;
    color: white;
    padding: 10px;
    font-size: 16px;
    border: none;
    cursor: pointer;
  }

  .dropdown-menu {
    display: none;
    position: absolute;
    background-color: #f9f9f9;
    min-width: 220px;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
    z-index: 1;
    padding: 20px 25px;
  }

  .dropdown-menu a {
    color: black;
    padding: 12px 16px;
    text-decoration: none;
    display: flex;
    width: 100%;
    justify-content: space-between;
  }

  .dropdown-menu a:hover {
    background-color: #f1f1f1;
  }

  .dropdown:hover .dropdown-menu {
    display: flex;
  }
</style>